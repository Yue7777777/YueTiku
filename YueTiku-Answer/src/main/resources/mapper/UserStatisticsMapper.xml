<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yuetiku.mapper.UserStatisticsMapper">

    <!-- 获取用户统计信息（按分类） -->
    <select id="getUserStatisticsByCategory" resultType="com.yuetiku.entity.UserStatistics">
        SELECT *
        FROM user_statistics
        WHERE user_id = #{userId} AND category_id = #{categoryId}
        ORDER BY updated_at DESC
    </select>

    <!-- 获取用户统计信息（全部分类） -->
    <select id="getUserStatistics" resultType="com.yuetiku.entity.UserStatistics">
        SELECT *
        FROM user_statistics
        WHERE user_id = #{userId}
        ORDER BY updated_at DESC
    </select>

    <!-- 获取用户全部分类统计 -->
    <select id="getOverallStatistics" resultType="com.yuetiku.entity.UserStatistics">
        SELECT *
        FROM user_statistics
        WHERE user_id = #{userId} AND category_id IS NULL
    </select>

    <!-- 获取用户分类统计列表 -->
    <select id="getCategoryStatistics" resultType="com.yuetiku.entity.UserStatistics">
        SELECT us.*, c.name as category_name
        FROM user_statistics us
        LEFT JOIN categories c ON us.category_id = c.id
        WHERE us.user_id = #{userId} AND us.category_id IS NOT NULL
        ORDER BY us.updated_at DESC
    </select>

</mapper>
