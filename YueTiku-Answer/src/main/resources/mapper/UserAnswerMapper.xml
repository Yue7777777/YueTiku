<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yuetiku.mapper.UserAnswerMapper">

    <!-- 获取用户答题历史（按分类） -->
    <select id="getUserAnswerHistoryByCategory" resultType="com.yuetiku.entity.UserAnswer">
        SELECT ua.*, q.title as question_title, c.name as category_name, q.type, q.difficulty
        FROM user_answers ua
        LEFT JOIN questions q ON ua.question_id = q.id
        LEFT JOIN categories c ON q.category_id = c.id
        WHERE ua.user_id = #{userId} AND q.category_id = #{categoryId}
        ORDER BY ua.answer_time DESC
        LIMIT #{offset}, #{limit}
    </select>

    <!-- 获取用户答题历史（全部分类） -->
    <select id="getUserAnswerHistory" resultType="com.yuetiku.entity.UserAnswer">
        SELECT ua.*, q.title as question_title, c.name as category_name, q.type, q.difficulty
        FROM user_answers ua
        LEFT JOIN questions q ON ua.question_id = q.id
        LEFT JOIN categories c ON q.category_id = c.id
        WHERE ua.user_id = #{userId}
        ORDER BY ua.answer_time DESC
        LIMIT #{offset}, #{limit}
    </select>

    <!-- 统计用户答题数量（按分类） -->
    <select id="countUserAnswersByCategory" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM user_answers ua
        LEFT JOIN questions q ON ua.question_id = q.id
        WHERE ua.user_id = #{userId} AND q.category_id = #{categoryId}
    </select>

    <!-- 统计用户答题数量（全部分类） -->
    <select id="countUserAnswers" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM user_answers ua
        WHERE ua.user_id = #{userId}
    </select>

    <!-- 获取用户最近答题记录 -->
    <select id="getRecentAnswers" resultType="com.yuetiku.entity.UserAnswer">
        SELECT *
        FROM user_answers
        WHERE user_id = #{userId}
        ORDER BY answer_time DESC
        LIMIT #{limit}
    </select>

</mapper>
